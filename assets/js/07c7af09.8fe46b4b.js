"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[189230],{15680:(e,t,o)=>{o.d(t,{xA:()=>d,yg:()=>m});var r=o(296540);function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function n(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function l(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?n(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,r,a=function(e,t){if(null==e)return{};var o,r,a={},n=Object.keys(e);for(r=0;r<n.length;r++)o=n[r],t.indexOf(o)>=0||(a[o]=e[o]);return a}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)o=n[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(a[o]=e[o])}return a}var i=r.createContext({}),c=function(e){var t=r.useContext(i),o=t;return e&&(o="function"==typeof e?e(t):l(l({},t),e)),o},d=function(e){var t=c(e.components);return r.createElement(i.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef((function(e,t){var o=e.components,a=e.mdxType,n=e.originalType,i=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(o),g=a,m=p["".concat(i,".").concat(g)]||p[g]||u[g]||n;return o?r.createElement(m,l(l({ref:t},d),{},{components:o})):r.createElement(m,l({ref:t},d))}));function m(e,t){var o=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var n=o.length,l=new Array(n);l[0]=g;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[p]="string"==typeof e?e:a,l[1]=s;for(var c=2;c<n;c++)l[c]=o[c];return r.createElement.apply(null,l)}return r.createElement.apply(null,o)}g.displayName="MDXCreateElement"},562384:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>n,metadata:()=>s,toc:()=>c});var r=o(58168),a=(o(296540),o(15680));const n={title:"Compute-storage decoupled quick start",language:"en"},l=void 0,s={unversionedId:"install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-quickstart",id:"version-3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-quickstart",title:"Compute-storage decoupled quick start",description:"\x3c!--",source:"@site/versioned_docs/version-3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-quickstart.md",sourceDirName:"install/cluster-deployment/k8s-deploy/compute-storage-decoupled",slug:"/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-quickstart",permalink:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-quickstart",draft:!1,tags:[],version:"3.0",frontMatter:{title:"Compute-storage decoupled quick start",language:"en"},sidebar:"docs",previous:{title:"How to enter the container when the service crashes",permalink:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-coupled/debug-crash"},next:{title:"Config and install FDB",permalink:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-metaservice/config-fdb"}},i={},c=[{value:"Install Operator",id:"install-operator",level:2},{value:"Compute-storage decoupled cluster quick start",id:"compute-storage-decoupled-cluster-quick-start",level:2},{value:"Install DorisDisaggregatedMetaService",id:"install-dorisdisaggregatedmetaservice",level:3},{value:"Config object storage",id:"config-object-storage",level:3},{value:"Install DorisDisaggregatedCluster",id:"install-dorisdisaggregatedcluster",level:3}],d={toc:c},p="wrapper";function u(e){let{components:t,...o}=e;return(0,a.yg)(p,(0,r.A)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,a.yg)("p",null,"Deploying a complete Doris Compute-storage decoupled cluster from scratch on K8s is divided into two parts: the first part deploys ",(0,a.yg)("inlineCode",{parentName:"p"},"Doris-Operator"),"; the second part distributes the relevant resources ",(0,a.yg)("inlineCode",{parentName:"p"},"DorisDisaggregatedMetaService")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"DorisDisaggregatedCluster")," for deploying the Compute-storage decoupled cluster. The ",(0,a.yg)("inlineCode",{parentName:"p"},"DorisDisaggregatedMetaService")," resource deploys the metadata component; the ",(0,a.yg)("inlineCode",{parentName:"p"},"DorisDisaggregatedCluster")," resource deploys the SQL parsing component and the computing component."),(0,a.yg)("h2",{id:"install-operator"},"Install Operator"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Create CRD\uff1a")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"kubectl create -f https://raw.githubusercontent.com/selectdb/doris-operator/master/config/crd/bases/crds.yaml\n")),(0,a.yg)("p",null,"Expected Results\uff1a"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"customresourcedefinition.apiextensions.k8s.io/foundationdbclusters.apps.foundationdb.org created\ncustomresourcedefinition.apiextensions.k8s.io/foundationdbbackups.apps.foundationdb.org created\ncustomresourcedefinition.apiextensions.k8s.io/foundationdbrestores.apps.foundationdb.org created\ncustomresourcedefinition.apiextensions.k8s.io/dorisdisaggregatedclusters.disaggregated.cluster.doris.com created\ncustomresourcedefinition.apiextensions.k8s.io/dorisdisaggregatedmetaservices.disaggregated.metaservice.doris.com created\n")),(0,a.yg)("ol",{start:2},(0,a.yg)("li",{parentName:"ol"},"Deploy Doris-Operator and dependent RBAC rules:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"kubectl apply -f https://raw.githubusercontent.com/selectdb/doris-operator/master/config/operator/disaggregated-operator.yaml\n")),(0,a.yg)("p",null,"Expected Results\uff1a"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"kubectl -n doris get pods\nNAME                                         READY   STATUS    RESTARTS   AGE\ndoris-operator-fdb-manager-d75574c47-b2sqx   1/1     Running   0          11s\ndoris-operator-5b667b4954-d674k              1/1     Running   0          11s\n")),(0,a.yg)("h2",{id:"compute-storage-decoupled-cluster-quick-start"},"Compute-storage decoupled cluster quick start"),(0,a.yg)("h3",{id:"install-dorisdisaggregatedmetaservice"},"Install DorisDisaggregatedMetaService"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Download ",(0,a.yg)("inlineCode",{parentName:"li"},"ddm-sample.yaml"),", a resource that tells Doris-Operator how to deploy metadata components.")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-shell"},"curl -O https://raw.githubusercontent.com/selectdb/doris-operator/master/doc/examples/disaggregated/metaservice/ddm-sample.yaml\n")),(0,a.yg)("p",null,"Deploy resources according to configuration metadata chapters: ",(0,a.yg)("a",{parentName:"p",href:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-metaservice/config-fdb"},"FDB"),", ",(0,a.yg)("a",{parentName:"p",href:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-metaservice/config-ms"},"ms"),", ",(0,a.yg)("a",{parentName:"p",href:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-metaservice/config-recycler"},"recycler")," Configure resources according to actual needs."),(0,a.yg)("ol",{start:2},(0,a.yg)("li",{parentName:"ol"},"Apply ",(0,a.yg)("inlineCode",{parentName:"li"},"DorisDisaggregatedMetaService"))),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"kubectl apply -f ddm-sample.yaml\n")),(0,a.yg)("p",null,"Expected Results\uff1a"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"kubectl get ddm\nNAME                   FDBSTATUS   MSSTATUS   RECYCLERSTATUS\nmeta-service-release   Available   Ready      Ready\n")),(0,a.yg)("h3",{id:"config-object-storage"},"Config object storage"),(0,a.yg)("p",null,"The Compute-storage decoupled cluster uses object storage as persistent storage. You need to use ConfigMap to deliver ","[object storage information used by the Compute-storage decoupled cluster]","(install-cluster/config-relation#Register object storage)."),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Download the ConfigMap resource that contains the object storage information:")),(0,a.yg)("p",null,"Compute-storage decoupled cluster uses object storage as the backend storage, and needs to plan the object storage to be used in advance. Download ",(0,a.yg)("inlineCode",{parentName:"p"},"object-store-info.yaml"),"."),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"curl -O https://raw.githubusercontent.com/selectdb/doris-operator/master/doc/examples/disaggregated/cluster/object-store-info.yaml\n")),(0,a.yg)("ol",{start:2},(0,a.yg)("li",{parentName:"ol"},"According to the ",(0,a.yg)("a",{parentName:"li",href:"../../../../compute-storage-decoupled/creating-cluster#%E5%86%85%E7%BD%AE%E5%AD%98%E5%82%A8%E5%90%8E%E7%AB%AF"},"Doris Compute-storage decoupled_interface")," format, configure the object storage information in JSON format, with ",(0,a.yg)("inlineCode",{parentName:"li"},"instance.conf")," as the key and the object storage information in JSON format as the value configured in the data of ConfigMap. (Replace the corresponding value in the sample JSON format)")),(0,a.yg)("p",null,"apply ",(0,a.yg)("inlineCode",{parentName:"p"},"object-store-info.yaml")," :"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f object-store-info.yaml\n")),(0,a.yg)("admonition",{title:"Tip",type:"tip"},(0,a.yg)("ul",{parentName:"admonition"},(0,a.yg)("li",{parentName:"ul"},"To deploy a Compute-storage decoupled cluster, you need to plan the object storage to be used in advance, and configure the object storage information through ConfigMap to the Namespace where the doris Compute-storage decoupled cluster needs to be deployed."),(0,a.yg)("li",{parentName:"ul"},"The configuration in the case is mainly to show the basic configuration information required for object storage. All values are fictitious and cannot be used in real scenarios. If you need to build a real and available cluster, please fill in the real data."))),(0,a.yg)("h3",{id:"install-dorisdisaggregatedcluster"},"Install DorisDisaggregatedCluster"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Download ",(0,a.yg)("inlineCode",{parentName:"li"},"ddc-sample.yaml"),":")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-shell"},"curl -O https://raw.githubusercontent.com/selectdb/doris-operator/master/doc/examples/disaggregated/cluster/ddc-sample.yaml\n")),(0,a.yg)("ol",{start:2},(0,a.yg)("li",{parentName:"ol"},"According to the chapters on configuring Compute-storage decoupled cluster: ",(0,a.yg)("a",{parentName:"li",href:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-cluster/config-relation"},"Cluster association configuration"),", ",(0,a.yg)("a",{parentName:"li",href:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-cluster/config-fe"},"fe"),", ",(0,a.yg)("a",{parentName:"li",href:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-cluster/config-cc"},"compute cluster"),", configure resources according to actual needs. Use the following command to deploy resources:")),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"kubectl apply -f ddc-sample.yaml\n")),(0,a.yg)("p",null,"The expected results of deploying a computing cluster are as follows:"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"kubectl get ddc\nNAME                         CLUSTERHEALTH   FEPHASE   CGCOUNT   CGAVAILABLECOUNT   CGFULLAVAILABLECOUNT\ntest-disaggregated-cluster   green           Ready     1         1                  1\n")),(0,a.yg)("admonition",{title:"Tip",type:"tip"},(0,a.yg)("ul",{parentName:"admonition"},(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"DorisDisaggregatedCluster")," must be configured to use ",(0,a.yg)("inlineCode",{parentName:"li"},"DorisDisaggregatedMetaService")," resource information in the ",(0,a.yg)("a",{parentName:"li",href:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-cluster/config-relation"},"specification"),"."),(0,a.yg)("li",{parentName:"ul"},"To deploy a Compute-storage decoupled cluster, you must plan the object storage you want to use in advance and configure the deployment according to the ",(0,a.yg)("a",{parentName:"li",href:"/docs/3.0/install/cluster-deployment/k8s-deploy/compute-storage-decoupled/install-cluster/config-relation"},"object storage configuration section")," in the cluster association configuration."))))}u.isMDXComponent=!0}}]);